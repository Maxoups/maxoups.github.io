<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Title -->
    <title>Ancestral Cookbook | Recherche</title>

    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css"/>

    <!-- Favicon -->
    <link rel="icon" href="img/core-img/favicon.ico">

    <!-- Core Stylesheet -->
    <link rel="stylesheet" href="style.css">

    <style>
        /* === Custom styles for search page === */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 20px 0;
        }

        .filters input,
        .filters select,
        .filters button {
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .tag {
            background: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 13px;
            cursor: pointer;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
        }

        .meal-item {
            background-color: var(--meal-bg, #e0f0ff);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        @media (prefers-color-scheme: dark) {
            .meal-item {
                --meal-bg: #2a3a4a;
                color: #f0f0f0;
            }
        }

        .meal-title {
            margin: 0 0 6px;
            font-size: 18px;
            font-weight: 600;
        }

        .meal-desc {
            font-size: 14px;
            opacity: 0.85;
        }
    </style>
</head>


<body>
    <div id="website-header"></div>

    <!-- ##### Breadcumb Area Start ##### -->
    <div class="breadcumb-area bg-img bg-overlay" style="background-image: url(img/bg-img/breadcumb3.jpg); margin-bottom: 40px;">
        <div class="container h-100">
            <div class="row h-100 align-items-center">
                <div class="col-12">
                    <div class="breadcumb-text text-center">
                        <h2>Recherche de recettes</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ##### Breadcumb Area End ##### -->

    <div class="container">
        <!-- Filters -->
        <div class="filters">
            <input type="text" id="searchBar" placeholder="Rechercher un nom de recette...">

            <select id="categoryFilter">
                <option value="">Toutes les cat√©gories</option>
            </select>

            <select id="chefFilter">
                <option value="">Tous les cuistots</option>
            </select>

            <input type="text" id="tagInput" placeholder="Ajouter un tag...">
            <button onclick="addTag()">+ Tag</button>
        </div>

        <!-- Active tags -->
        <div class="tags-container" id="activeTags"></div>

        <!-- Results -->
        <div class="results" id="results"></div>
    </div>


    <!-- jQuery (required by Owl Carousel) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Owl Carousel JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>

    <!-- PapaParse -->
    <script src="js/PapaParse-5.0.2/papaparse.min.js"></script>
    <script src="js/recipe_functions.js"></script>

    <!-- jQuery-2.2.4 js -->
    <script src="js/jquery/jquery-2.2.4.min.js"></script>
    <!-- Popper js -->
    <script src="js/bootstrap/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="js/bootstrap/bootstrap.min.js"></script>
    <!-- All Plugins js -->
    <script src="js/plugins/plugins.js"></script>
    <!-- Active js -->
    <script src="js/active.js"></script>

    <script>
        // ü•ò Exemple: tu remplaces recipesDataPLACEHOLDER par ta variable globale apr√®s parsing CSV
        const recipesDataPLACEHOLDER = [
            { ID: "1", Titre: "Tiramisu", Type: "Dessert", Cuistot: "Kaki", Tags: ["caf√©", "sucr√©"] },
            { ID: "2", Titre: "Lasagnes", Type: "Plat", Cuistot: "M√©linouche", Tags: ["p√¢tes", "fromage"] },
            { ID: "3", Titre: "Salade C√©sar", Type: "Entr√©e", Cuistot: "Kaki", Tags: ["salade", "poulet"] }
        ];

        const searchBar = document.getElementById("searchBar");
        const categoryFilter = document.getElementById("categoryFilter");
        const chefFilter = document.getElementById("chefFilter");
        const resultsDiv = document.getElementById("results");
        const tagInput = document.getElementById("tagInput");
        const activeTagsDiv = document.getElementById("activeTags");

        let activeTags = [];

        function initFilters() {
        categoryFilter.innerHTML = `<option value="">Toutes les cat√©gories</option>`;
        chefFilter.innerHTML = `<option value="">Tous les cuistots</option>`;

        if (!recipesDataPLACEHOLDER || recipesDataPLACEHOLDER.length === 0) {
            console.warn("recipesDataPLACEHOLDER is empty when building filters");
            return;
        }

        // Normalize keys just in case (toLowerCase)
        const types = [...new Set(recipesDataPLACEHOLDER.map(r => (r.Type || r.type || "").trim()).filter(Boolean))];
        const chefs = [...new Set(recipesDataPLACEHOLDER.map(r => (r.Cuistot || r.cuistot || "").trim()).filter(Boolean))];

        types.forEach(type => {
            const opt = document.createElement("option");
            opt.value = type;
            opt.textContent = type;
            categoryFilter.appendChild(opt);
        });

        chefs.forEach(chef => {
            const opt = document.createElement("option");
            opt.value = chef;
            opt.textContent = chef;
            chefFilter.appendChild(opt);
        });

        console.log("chefFilter = " + chefs);
        console.log("categoryFilter = " + types);
        }


        function addTag() {
            const tag = tagInput.value.trim();
            if (tag && !activeTags.includes(tag)) {
                activeTags.push(tag);
                renderTags();
                filterRecipes();
            }
            tagInput.value = "";
        }

        function removeTag(tag) {
            activeTags = activeTags.filter(t => t !== tag);
            renderTags();
            filterRecipes();
        }

        function renderTags() {
            activeTagsDiv.innerHTML = "";
            activeTags.forEach(tag => {
                const span = document.createElement("span");
                span.className = "tag";
                span.textContent = tag + " ‚úï";
                span.onclick = () => removeTag(tag);
                activeTagsDiv.appendChild(span);
            });
        }

        function filterRecipes() {
            const searchTerm = searchBar.value.toLowerCase();
            const category = categoryFilter.value;
            const chef = chefFilter.value;

            const filtered = recipesDataPLACEHOLDER.filter(recipe => {
                const matchesSearch = recipe.Titre.toLowerCase().includes(searchTerm);
                const matchesCategory = !category || recipe.Type === category;
                const matchesChef = !chef || recipe.Cuistot === chef;
                const matchesTags = activeTags.every(tag => recipe.Tags.map(t => t.toLowerCase()).includes(tag.toLowerCase()));

                return matchesSearch && matchesCategory && matchesChef && matchesTags;
            });

            renderResults(filtered);
        }

        function renderResults(list) {
            resultsDiv.innerHTML = "";
            if (list.length === 0) {
                resultsDiv.innerHTML = "<p>Aucune recette trouv√©e.</p>";
                return;
            }

            list.forEach(r => {
                const div = document.createElement("div");
                div.className = "meal-item";
                div.onclick = () => window.open(`recipe.html?name=${r.ID}`, "_blank");
                div.innerHTML = `
                    <h3 class="meal-title">${r.Titre}</h3>
                    <p class="meal-desc">Type: ${r.Type} ‚Ä¢ Cuistot: ${r.Cuistot}</p>
                    <p class="meal-desc">Tags: ${r.Tags.join(", ")}</p>
                `;
                resultsDiv.appendChild(div);
            });
        }

        searchBar.addEventListener("input", filterRecipes);
        categoryFilter.addEventListener("change", filterRecipes);
        chefFilter.addEventListener("change", filterRecipes);

        // Init
        initFilters();
        filterRecipes();
    </script>
</body>
</html>
